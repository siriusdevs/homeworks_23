"""Tests for the hw3 module."""
import pytest

from hw3 import Book, Librarian, Library, Reader

BOOK_NAME = 'The Lord of the Rings'
BOOK_AUTHOR = 'J. R. R. Tolkien'
BOOK_YEAR = 1954


@pytest.fixture
def book() -> Book:
    """
    Returns a book.

    Returns:
        Book: The book with the name, author and year of publication.
    """
    return Book(BOOK_NAME, BOOK_AUTHOR, BOOK_YEAR)


def test_book_fail():
    """
    Tests the Book class with wrong parameters.
    """
    with pytest.raises(TypeError):
        Book(1, 2, 3)

    with pytest.raises(TypeError):
        Book(1, '2', 3)

    with pytest.raises(TypeError):
        Book('1', 2, 3)

    with pytest.raises(TypeError):
        Book('1', '2', '3')


@pytest.fixture
def library(book: Book) -> Library:
    """
    Returns a library.

    Returns:
        Library: The library with the book in it.
    """
    library = Library([book])
    return library


def test_library(library: Library, book: Book):
    assert library.get_books() == [book]

    library.delete_book(book)
    assert library.get_books() == []

    library.add_book(book)
    assert library.get_books() == [book]


def test_library_fail(library: Library, book: Book):
    with pytest.raises(TypeError):
        library.book_list = [1, 2, 3]

    with pytest.raises(TypeError):
        library.book_list = [book, 2, 3]


@pytest.fixture
def librarian(library: Library, book: Book) -> Librarian:
    """
    Returns a librarian.

    Returns:
        Librarian: The librarian with the library.
    """
    librarian = Librarian('John', library)

    return librarian


def test_librarian(librarian: Librarian, library: Library, book: Book):
    """
    Tests the Librarian class.

    Parameters:
        librarian (Librarian): The librarian to test with.
        library (Library): The library to test with.
        book (Book): The book to test with.
    """
    assert librarian.name == 'John'
    assert librarian.library == library

    assert librarian.give_book(book) == book
    assert librarian.library.book_list == []

    librarian.receive_book(book)
    assert librarian.library.book_list == [book]


def test_librarian_fail(librarian: Librarian, library: Library, book: Book):
    """
    Tests the Librarian class with wrong parameters.

    Parameters:
        librarian (Librarian): The librarian to test with.
        library (Library): The library to test with.
        book (Book): The book to test with.
    """
    with pytest.raises(TypeError):
        librarian.name = 1

        librarian.library = 1

        librarian.give_book(1)

        librarian.receive_book(1)

    with pytest.raises(ValueError):
        librarian.give_book(Book('a', 'b', 1220))


def test_reader(book: Book, librarian: Librarian):
    """
    Tests the Reader class.

    Parameters:
        book (Book): The book to test with.
        librarian (Librarian): The librarian to test with.
    """
    reader = Reader('Jack')
    assert reader.name == 'Jack'
    assert reader.books == []

    reader.take_book(book, librarian)
    assert reader.books == [book]
    assert librarian.library.book_list == []

    reader.return_book(book, librarian)
    assert reader.books == []
    assert librarian.library.book_list == [book]


def test_reader_fail(book: Book, librarian: Librarian):
    """
    Tests the Reader class with wrong parameters.

    Parameters:
        book (Book): The book to test with.
        librarian (Librarian): The librarian to test with.
    """
    reader = Reader('Jack')
    with pytest.raises(TypeError):
        reader.name = 1

        reader.take_book(1, librarian)

        reader.return_book(1, librarian)

    with pytest.raises(ValueError):
        reader.return_book(book, librarian)
